# Техническо Задание - dshome.dev E-commerce Platform

Последна актуализация: 22 Октомври 2025

---

## Описание

Този документ описва детайлните изисквания, архитектурата и функционалностите за административния панел на персонализирана платформа за електронна търговия.

---

## Секция 1: Каталог

Модулът "Каталог" управлява всички аспекти на продуктите, техните класификации и свързаните с тях данни.

---

### 1.1 Продукти

**Статус:** ЧАСТИЧНО ИМПЛЕМЕНТИРАН
- Референция: [ProductResource.php](../app/Filament/Resources/Products/ProductResource.php)
- Model: [Product.php](../app/Models/Product.php)
- Migration: [2025_10_21_000002_create_products_table.php](../database/migrations/2025_10_21_000002_create_products_table.php)

Управлението на продуктите е разделено на две основни части: общ преглед (списък) и детайлна страница за създаване/редакция.

---

#### 1.1.1 Преглед (Списък с продукти)

**Изглед:** Табличен списък на всички добавени продукти.

**Функционалности:**

**Чекбоксове:**
- В началото на всеки ред има чекбокс за избор на множество продукти

**Масови действия:**
- Падащо меню, което се активира при избор на поне един продукт
- Опции: Активиране, Деактивиране, Дублиране, Изтриване

**Филтриране по категории:**
- Падащо меню над таблицата за филтриране на продуктите, принадлежащи към конкретна категория

**Колони в таблицата:**

| Колона | Описание | Филтър | Статус |
|--------|----------|--------|--------|
| ID | Уникално ID на продукта от базата данни | Сортиране (възходящ/низходящ ред) + поле за търсене по конкретно ID | TODO |
| Изображение | Миниатюра на основната снимка на продукта | Няма | TODO (липсва images relation) |
| Референция | Уникален и задължителен ref.number (SKU) | Поле за търсене по референция | ГОТОВО (има sku поле) |
| Категория | Показва категорията по подразбиране | Поле за търсене по име на категория | ГОТОВО (има category relation) |
| Цена | Показва продажната цена с ДДС | Две полета за задаване на ценови диапазон (от / до) | ЧАСТИЧНО (има price, липсва ДДС калкулация) |
| Количество | Показва общото количество на продукта | Две полета за задаване на количествен диапазон (от / до) | ГОТОВО (има quantity поле) |
| Характеристики | Падащо меню за избор на вече дефинирана характеристика и нейна стойност за филтриране | Динамичен филтър | TODO (липсва features relation) |
| Статус | Превключвател (On/Off) за бърза активация/деактивация | Филтър по статус | ГОТОВО (има active boolean) |
| Редакция | Икона (напр. молив) за отваряне на страницата за редакция на продукта | N/A | TODO |
| Действия | Падащо меню с опции: Преглед, Дублиране, Изтриване | N/A | TODO |

---

#### 1.1.2 Създаване / Редакция на продукт

Страницата за управление на продукт е разделена на табове с групирани полета.

**Таб 1: Основни настройки**

**Изображения:** TODO (липсва product_images таблица)
- Интерфейс за качване на множество изображения
- При маркиране на качена снимка се появява чекбокс `[ ]` Основна снимка
- До всяка снимка има поле за ALT текст
- По подразбиране ALT се генерира автоматично: `{Заглавие на продукта} - {пореден номер}` (напр. "Печка на дърва - 1")

**Описания:** TODO (има само едно поле description)
- Кратко описание: WYSIWYG текстов редактор
- Дълго описание: WYSIWYG текстов редактор
- Изискване: И двата редактора трябва да имат бутон за превключване към изглед на генерирания HTML код

**Връзки:** TODO
- Бутон `+ Добави характеристика`: Отваря модален прозорец за избор на дефинирани характеристики и стойности
- Бутон `+ Добави марка`: Отваря падащо меню за избор от дефинираните марки

**Комбинации:** TODO (липсва product_variants таблица и attributes)
- Радио бутони: `( )` Обикновен продукт (по подразбиране) / `( )` Продукт с комбинации
- При избор на "Комбинации" се появява генератор
- В генератора се показват дефинираните Атрибути (напр. Цвят, Размер)
- Администраторът избира атрибути и стойности, след което натиска бутон "Генерирай"
- Системата създава таблица с всички възможни комбинации
- За всяка комбинация могат да се зададат:
  - Реф. номер (задължително)
  - Влияние върху теглото (+/-)
  - Влияние върху цената (+/-)
  - Тези стойности се добавят към основните за продукта

**Основни данни:** ЧАСТИЧНО ГОТОВО
- Референция: Задължително поле (ГОТОВО - има sku unique)
- Количество: Не се редактира ръчно. Сбор от наличностите по складове или сбор от количествата на комбинациите (TODO - сега е обикновено поле)
- Цена (с ДДС / без ДДС): Въвежда се едната стойност, другата се изчислява автоматично на база ДДС от настройките (TODO - сега само price поле)
- Категории: Дървовидна структура за избор на множество категории. Има опция за маркиране на една категория като "по подразбиране" (ЧАСТИЧНО - има category_id, но липсва many-to-many relation)

**Таб 2: Количество** TODO
- Показва общото количество
- Под него има таблица с разбивка на наличностите по всеки дефиниран Склад

**Таб 3: Доставка** TODO (липсват полета)
- Размери: Полета за Ширина, Височина, Дълбочина, Тегло
- Срок за доставка: Избор от предефинирани стойности (от Настройки) или поле за свободен текст
- Налични куриери: Списък с всички активни куриери
  - По подразбиране всички са избрани
  - Администраторът може да премахне отметка, за да скрие даден куриер като опция за доставка за този конкретен продукт

**Таб 4: Цени** TODO
- Ценообразуване:
  - Цена на дребно (с/без ДДС)
  - Себестойност: Доставната цена без ДДС
  - Марж: Поле, което не се редактира. Автоматично изчислява печалбата в стойност (лв.) и проценти (%)
- Намаления:
  - Бутон `+ Добави намаление`
  - Показват се полета за период на валидност (от дата / до дата)
  - Поле за стойност на отстъпката и избор дали тя е сума (лв.) или процент (%)

**Таб 5: SEO** ЧАСТИЧНО ГОТОВО
- Мета заглавие и Мета описание (ще се генерират автоматично от SEO модул, с опция за ръчна промяна) - ГОТОВО (има meta_title, meta_description)
- SEO URL (автоматично транслитериран от заглавието, с опция за ръчна промяна) - ГОТОВО (има slug)
- Canonical URL (по подразбиране копира SEO URL, с опция за ръчна промяна) - TODO

**Таб 6: Опции** ЧАСТИЧНО ГОТОВО
- Видимост: Падащо меню с опции: Видим / Невидим
  - Видим: Продуктът се показва в категории, търсене и е достъпен по URL
  - Невидим: Продуктът е достъпен само ако се отвори директният му URL. Не се показва в категории и търсене
  - ЧАСТИЧНО (има active boolean, но не е същото като visibility enum)
- Доставчици: Падащо меню за избор на доставчик от списъка - TODO (липсва suppliers таблица и relation)

---

### 1.2 Категории

**Статус:** ЧАСТИЧНО ИМПЛЕМЕНТИРАН
- Референция: [CategoryResource.php](../app/Filament/Resources/Categories/CategoryResource.php)
- Model: [Category.php](../app/Models/Category.php)
- Migration: [2025_10_21_000001_create_categories_table.php](../database/migrations/2025_10_21_000001_create_categories_table.php)

**Изглед:** Йерархична структура (дървовидна)
- По подразбиране се показват категориите от първо ниво
- При клик върху категория се зарежда нов екран с нейните подкатегории
- TODO: Имплементиране на tree view (consider Filament Tree plugin)

**Полета при създаване/редакция:**

| Поле | Описание | Статус |
|------|----------|--------|
| Име на категорията | Задължително текстово поле | ГОТОВО (name) |
| Статус | Превключвател (Активна / Неактивна) | ГОТОВО (active boolean) |
| Родителска категория | Дървовидна структура за избор на родител | ГОТОВО (parent_id self-reference) |
| Описание | WYSIWYG редактор | ГОТОВО (description text) |
| Изображение | FileUpload поле | ГОТОВО (image string) |
| Мета заглавие | SEO поле | ГОТОВО (meta_title) |
| Мета описание | SEO поле | ГОТОВО (meta_description) |
| URL адрес | Автоматично генериран от името, с опция за ръчна промяна | ГОТОВО (slug unique) |
| Sort order | Поредност на показване | ГОТОВО (sort_order integer) |

**Логика:**
- Ако нова категория се постави в Ниво 3, тя автоматично трябва да се асоциира и с Ниво 2 и Ниво 1 - TODO (трябва custom logic)

---

### 1.3 Складове

**Статус:** НЕ ИМПЛЕМЕНТИРАН

Складовете представляват физическите магазини и точки за наличност.

**Полета при създаване/редакция:**

| Поле | Тип | Описание | Статус |
|------|-----|----------|--------|
| Име | string | Име на склада | TODO |
| Снимка | string/file | Снимка на склада | TODO |
| Адрес | text | Пълен адрес | TODO |
| Локация | json | Интерактивна карта за посочване на местоположение (latitude/longitude) | TODO |
| Работно време | text/json | Работно време на склада | TODO |
| Телефон | string | Телефон (трябва да генерира tel: линк) | TODO |
| URL | string | URL за повече информация (напр. линк към страницата на магазина) | TODO |
| Физически магазин | boolean | Чекбокс `[ ]` Физически магазин. Ако е маркиран, този склад се показва като опция за "Вземи от магазин" при поръчка | TODO |
| Статус | boolean | Активен/Неактивен | TODO |

**Интеграция:**
- Името на склада се използва в модул "Наличности" за импорт на количества
- Във frontend, на страницата на продукта, се показва наличността във всички физически магазини (зелено/червено)
- Many-to-Many relation с Products за наличности (pivot: quantity, reserved)

---

### 1.4 Атрибути и Характеристики

**Статус:** НЕ ИМПЛЕМЕНТИРАН

**Атрибути:** Използват се за генериране на продуктови комбинации (variants)

| Поле | Тип | Описание | Статус |
|------|-----|----------|--------|
| Име | string | Име на атрибута (напр. "Цвят", "Размер") | TODO |
| Тип на показване | enum | Радио бутон / Падащо меню / Цвят | TODO |
| Стойности | relation | Множество стойности за атрибута | TODO |

**Таблица: Attribute Values**

| Поле | Тип | Описание | Статус |
|------|-----|----------|--------|
| attribute_id | foreignId | Връзка към атрибута | TODO |
| Стойност | string | Напр. "Бял", "Черен", "XL" | TODO |
| HEX код | string | За тип "Цвят" | TODO |
| Изображение | string | За тип "Цвят" (алтернатива на HEX) | TODO |

**Характеристики (Features):** Използват се за филтриране и техническа информация. Не влияят на цената или реф. номер.

**Таблица: Feature Groups**

| Поле | Тип | Описание | Статус |
|------|-----|----------|--------|
| Име | string | Име на групата (напр. "Технически детайли") | TODO |
| Sort order | integer | Поредност на показване | TODO |

**Таблица: Features**

| Поле | Тип | Описание | Статус |
|------|-----|----------|--------|
| feature_group_id | foreignId | Връзка към групата | TODO |
| Име | string | Име на характеристиката (напр. "Мощност") | TODO |
| Стойност | string | Текстова стойност | TODO |

**Таблица: Product Features** (Pivot)

| Поле | Тип | Описание | Статус |
|------|-----|----------|--------|
| product_id | foreignId | Връзка към продукта | TODO |
| feature_id | foreignId | Връзка към характеристиката | TODO |
| value | string | Стойност за конкретния продукт | TODO |

---

### 1.5 Марки и Доставчици

**Статус:** НЕ ИМПЛЕМЕНТИРАН

**Марки (Brands):**

| Поле | Тип | Описание | Статус |
|------|-----|----------|--------|
| Име | string | Име на марката | TODO |
| Лого | string/file | Лого на марката | TODO |
| Описание | text | WYSIWYG редактор | TODO |
| Мета заглавие | string | SEO поле | TODO |
| Мета описание | text | SEO поле | TODO |
| SEO URL | string | Slug за марката | TODO |
| Статус | boolean | Активна/Неактивна | TODO |

**Доставчици (Suppliers):**

| Поле | Тип | Описание | Статус |
|------|-----|----------|--------|
| Име | string | Име на доставчика (за вътрешна употреба и статистика) | TODO |

---

### 1.6 Настройки на каталога

**Статус:** НЕ ИМПЛЕМЕНТИРАН

| Настройка | Тип | Описание | Статус |
|-----------|-----|----------|--------|
| ДДС (%) | decimal | Глобална стойност в проценти за изчисляване на цени | TODO |
| Брой продукти на страница | integer | За показване в категориите във frontend | TODO |
| Период "Нов продукт" (дни) | integer | За автоматично маркиране на продукти като "нови" | TODO |
| Време за доставка | text | Текст по подразбиране, който може да се избира при редакция на продукт | TODO |
| Подредба по подразбиране | enum | Избор за подредба на продуктите в категориите (по цена, дата, име и т.н.) | TODO |

---

## Секция 2: Поръчки

**Статус:** НЕ ИМПЛЕМЕНТИРАН

---

### 2.1 Списък с поръчки

**Изглед:** Таблица с филтри над всяка колона

| Колона | Описание | Филтър | Статус |
|--------|----------|--------|--------|
| Номер поръчка | Уникален номер на поръчката | Търсене по номер | TODO |
| Клиент | Име на клиента | Търсене по име | TODO |
| Товарителница | Номер на товарителница | Търсене | TODO |
| Куриер | Име на куриера | Падащо меню | TODO |
| Обща сума | Обща сума на поръчката | Ценови диапазон (от/до) | TODO |
| Статус | Статус на поръчката | Падащо меню с наличните статуси | TODO |
| Продукти | Списък с продукти | Няма | TODO |
| Реф. номер | Референции на продуктите | Търсене | TODO |
| Дата на поръчката | Дата на създаване | Период (от/до) | TODO |
| Телефон | Телефон на клиента | Търсене | TODO |
| Действия | Падащо меню | N/A | TODO |

**Действия:**
- Генериране на товарителница
- Преглед
- Изтриване

---

### 2.2 Преглед на поръчка

**Хедър:**
- Номер поръчка
- Име на клиента
- Сума
- Дата

**Бутони за действия:**
- Падащо меню за смяна на Статус
- Бутон "Генерирай товарителница"
- Бутон "Изтрий"

**Секция "Клиент":**
- Име
- Имейл
- Адрес за доставка
- Бележки: Текстово поле, видимо само за администратори
- Съобщения: Интерфейс за комуникация между администратор и клиент

**Секция "Продукти":**
- Списък на поръчаните продукти (миниатюра, име, цена, количество, обща сума)
- Под всеки продукт има хоризонтален ред, показващ наличността му във всички складове (подредени по ID)
- Наличността е в зелено квадратче (>0) или червено (=0)

**Секция "Общо":**
- Разбивка на сумата:
  - Продукти (стойност)
  - Доставка (стойност)
  - Общо за плащане

**Табове:**

**Таб "Статус":**
- История на промените на статуса

**Таб "Куриери":**
- Показва избран куриер, тегло, цена за доставка
- Съдържа линк "Редактирай", който отваря модален прозорец за въвеждане/промяна на номер на товарителница

**Секция "Разгледани страници":** (сгъваема секция)
- Показва историята на сесията на потребителя
- Всички разгледани страници преди да направи поръчката
- Referrer информация
- Данните се събират от бъдещ модул "Collect Stats"

---

### 2.3 Статуси на поръчки

**Управление:** Интерфейс за създаване и редакция на статуси

**Полета:**

| Поле | Тип | Описание | Статус |
|------|-----|----------|--------|
| Име на статуса | string | Име | TODO |
| Цвят на текст | string | HEX код за цвят на текста | TODO |
| Цвят на фон | string | HEX код за цвят на фона | TODO |
| Изпрати e-mail | boolean | Чекбокс `[ ]` Изпрати e-mail на клиент | TODO |
| Имейл темплейт | foreignId | Падащо меню за избор на имейл темплейт | TODO |

---

### 2.4 Клиенти

**Списък:**

| Колона | Описание | Статус |
|--------|----------|--------|
| ID | Уникално ID | TODO |
| Име и Фамилия | Пълно име | TODO |
| Имейл адрес | Email | TODO |
| Продажби | Обща сума на поръчките | TODO |
| Статус | Активен/Неактивен | TODO |
| Имейл промоции | Да/Не | TODO |
| Регистриран на | Дата на регистрация | TODO |
| Действия | Преглед, Редакция, Изтриване | TODO |

**Създаване/Редакция:**

**Таб "Основни":**
- Име
- Имейл
- Парола
- Статус
- Абонамент за промоции

**Таб "Адреси":**
- Възможност за добавяне на множество адреси
- Всеки адрес съдържа:
  - Град
  - Пощенски код
  - Улица/Квартал/Офис
  - Телефон
  - Фирма
  - ДДС номер на фирмата

---

## Секция 3: Доставка

**Статус:** НЕ ИМПЛЕМЕНТИРАН

---

### 3.1 Куриери

**Основни полета:**

| Поле | Тип | Описание | Статус |
|------|-----|----------|--------|
| Име | string | Име на куриера | TODO |
| Лого | string/file | Лого на куриера | TODO |
| URL за проследяване | string | URL template за проследяване на пратки | TODO |
| Статус | boolean | Активен/Неактивен | TODO |

**API Интеграция:**
- Полета за API ключове (напр. за Еконт, Спиди)
- Основна цел: извличане на актуален списък с офиси

**Ценообразуване:** Гъвкава система за дефиниране на цени чрез правила

**Тип "По тегло":**
- Таблица с диапазони (напр. от 0 до 1 кг, от 1 до 2 кг)
- Отделни цени за доставка до адрес и до офис

**Тип "Палетна доставка":**
- Фиксирана цена за палет до определено тегло (напр. 70 лв. за палет до 800 кг)
- Цената се мултиплицира за всеки следващ диапазон (напр. 801-1600 кг = 2x70 лв.)

**Тип "Вземи от магазин":**
- Безплатна доставка, но с ограничение за максимално тегло
- При избор се показват само складовете, маркирани като "Физически магазин"

---

### 3.2 Настройки за доставка

**Правило за безплатна доставка:**
- Глобално правило, което се активира само ако са изпълнени едновременно две условия:
  - Поръчка над X лв.
  - Тегло под Y кг
- Това правило е с по-висок приоритет от цените на куриерите
- Може да бъде заменено от правила в модул "Промоции"

---

## Секция 4: Плащане

**Статус:** НЕ ИМПЛЕМЕНТИРАН

---

### 4.1 Начини на плащане

**Наложен платеж:**
- Име
- Лого
- Информационен текст
- Такса (като % или фиксирана сума)

**Банков превод:**
- Име
- Лого
- Информационен текст (с полета за банкови детайли)

**Плащане с карта:**
- Име
- Лого
- Възможност за добавяне на няколко доставчика:
  - PayPal
  - DSK
  - Stripe
  - Други
- API ключове за всеки доставчик
- Режим: Тестов / Работен

---

### 4.2 Настройки за плащане

**Система от правила:**
- Позволява създаването на правила, които скриват методи за плащане при определени условия

**Примерно правило:**
- АКО (тегло > 300 кг) И (сума на поръчката > 1000 лв)
- ТОГАВА скрий метод "Наложен платеж"

---

## Секция 5: Модули и Технологии

**Статус:** БЪДЕЩИ ПЛАНОВЕ

---

### 5.1 Интелигентна Търсачка

**Технология:** Самостоятелно хоствана (self-hosted) търсачка
- Препоръчително: MeiliSearch
- Инсталирана на сървъра

**Функционалности:**
- AutoComplete: Предложения в реално време
- Толерантност към правописни грешки (Typo Tolerance)
- Изключително бързи резултати (милисекунди)
- Пълен контрол и собственост върху данните

---

### 5.2 Визуален редактор на съдържание (Headless CMS)

**Технология:** Самостоятелно хоствана (self-hosted) система за управление на съдържание
- Препоръчително: Payload CMS или Strapi
- Инсталирана на сървъра

**Цел:**
- Да позволи на нетехнически потребители да изграждат и редактират страници
- Страници: начална, блог, информационни
- Визуално сглобяване на предварително кодирани компоненти
- Компоненти: банери, слайдъри, продуктови мрежи
- Свобода, подобна на Elementor, но в "headless" архитектура

---

### 5.3 Други модули

| Модул | Описание | Статус |
|-------|----------|--------|
| SEO модул | За автоматизация на мета тагове, генериране на sitemap и др. | TODO |
| Филтри | За "faceted search" във frontend | TODO |
| Промоции | За създаване на сложни промоционални правила | TODO |
| Ревюта и рейтинг | Система за потребителски оценки | TODO |
| Импорт/Експорт | Инструменти за масова работа с данни | TODO |
| Блог | Управление на постове, категории, автори | TODO |

---

## Обобщение на статуса

**ИМПЛЕМЕНТИРАНО (ЧАСТИЧНО):**
- Продукти: Базова структура с основни полета
- Категории: Пълна структура с йерархия

**НЕ ИМПЛЕМЕНТИРАНО:**
- Складове
- Атрибути и Характеристики
- Марки и Доставчици
- Настройки на каталога
- Поръчки (целия модул)
- Доставка (целия модул)
- Плащане (целия модул)
- Допълнителни модули

**СЛЕДВАЩИ СТЪПКИ:**
1. Имплементиране на Складове
2. Имплементиране на Марки
3. Имплементиране на Доставчици
4. Имплементиране на Атрибути
5. Обогатяване на Products с липсващите връзки
6. Преструктуриране на Filament навигация под "Каталог"

---

*Последна актуализация: 22 Октомври 2025*
